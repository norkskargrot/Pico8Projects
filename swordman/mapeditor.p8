pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function loadmap(i)
	memset(0x2000,0,0x1000)
	decompresmap(0,0,rooms[i].data)
	cstore(0x2000,0x2000,0x1000)		
end

function savemap(i)
	printh(compresmap(0,0,rooms[i].w,rooms[i].h),"@clip")
end

function loadsprites()
	reload(0x0,0x0,0x0fff,'swordman.p8')
	cstore(0x0,0x0,0x0fff)
end
-->8
rooms={
	{w=16,h=16,
		data="qarerq_?cebfuebe?taaqereu<)arqbfra_?eaaerebf?lqeuqreqa_?daaerebf?lqeuqreq<pbaiserq_?cebfue7i?taa=e_j0qserqbfri+?daaeqebj 2serqbfr<5baarepy=lrebf?lae?taa?xaerq_haabe?paa8a-haa-lrq_laa_?ea6ma<caaa7iu<ai7<)aay7esa-daa-d=qbe-edeaa-eqace5aaa5aaf?laapaaa9aam6ecaa<cau<)aa<baambaaatmaaaeaqbeaaaeaa-i6ece6<)csubm_a",
		exts={
			{dir="⬅️",l=9,h=11,r=2,nh=13},
			{dir="➡️",l=13,h=13,r=2,nh=13},
			{dir="➡️",l=10,h=10,r=2,nh=10},
			{dir="⬆️",l=10,h=13,r=5,nh=7},
		}
	},
	{w=26,h=16,
		data=".abeam_?ka-e?)aeam=?ia6fsubi7<?aqici7<)aqa-e?9aata7i-edeqasi=atmqa7iam=?ga6fsube=<?aqatm?tae=a-e?paawi7evasi8abe6e8i?pae6eceqa-i?paa9asi8atm=abe-e9mqici7atmqabat<?aambm_i+?ca7i?tae=atm?paeam=?da-iaa-d?laa=abe?xaaqasi8a-e?paataaa5<pdaatm=a-i?paa9aaa)<5daa7esu7i?laataaap<5daabi7a7m?laa9aaa5<)daatm?taataaa)<?aaabi7i=?na-iaa-d?laa6ecm_ide?xaa7a7iqabi7m7iqasiqicm_asi6eceaa6i6esm8i9i8atm9i9i-e9i=a7i-edm_abaaidm_a",
		exts={	
			{dir="⬅️",l=13,h=13,r=1,nh=13},
			{dir="⬅️",l=10,h=10,r=1,nh=10},
			{dir="➡️",l=11,h=13,r=1,nh=11},
			{dir="⬇️",l=21,h=22,r=3,nh=7.5},
			{dir="⬇️",l=7,h=7,r=4,nh=6},
		}
	},
	{w=16,h=24,
		data="q6bi7<pbqaaa?tae6ecm_<?caatmq<5baasi?xaaqa_?daaeqatmqa_?da6iq<5daide?|aa6ece?@aaqasi-e+?laam_a_?naaeq<)aaabi7<)aqi=?daaeq<?aaatmqaaa=aaa?pae?)aa6ece6ece?@aa-ede-e+?laai7a_?daae?5aa-ede?paaqi=?haaeq<?aaa7m6ece?taaqa_?daaeqatmqa_?daaeq<5daabe?}aaqa_?naaeq<5daabe?}aaqa_?naaea",
		exts={
			{dir="⬆️",l=7,h=8,r=2,nh=21.5},
			{dir="⬇️",l=1,h=14,r=1,nh=6},
			{dir="➡️",l=5,h=5,r=4,nh=1},
		}
	},
	{w=16,h=16,
		data="qa7i=i8i-e+i=icm_i8mqicm?xaat<)baasiq<pbam=?gaam_asi?paat<)baasi-edi7aaa9<)baatm6ecm_a6it<)baasi-e+?ca6m9aaaq<?aaatm6e=?da-e?1aa6ecm_<?aam=?eaaeaatm6e=?da-e?1aa6ecm_<)aayrf?laaq<)aaatm6e=?ca-eq<)baasi-e+?ca-iaaae?taa-edi7aaeam_?haai7atm?l6ev<?bsatm6eci7asi6eci7asi6eci7a",
		exts={
			{dir="⬅️",l=1,h=1,r=3,nh=5},
		}
	},
	{w=16,h=16,
		data="qarerqreqa_?daaeuereu<)arqreq<pbaicfrebf?lqeuebe?taa=qrerq_?cebfra_?daae8qrerq_?cebfr<5baidfrebf?lqeue_?faaeuereu<)arqbe6ece?laaqarerq_?cebf5atm?taapereu<)arq_lq<5ba<rerq_?cebfpa_?caaeqi=lrebf?lqeu<be?taa=<qerq_?cebf)a_?eaae5ereu<)arq_dqa_?daae)ereu<)arq_h8<pbaa_drebf?lqeu<8m?taa8<rerq_?de_dq<?aaa7m)<?areba",
		exts={
			{dir="⬇️",l=5,h=8,r=1,nh=12},
		}
	},
}
-->8
--map compressing
chr6,asc6,char6={},{},"abcdefghijklmnopqrstuvwxyz.1234567890 !@#$%,&*()-_=+[{]};:'|<>/?"
for i=0,63 do
  c=sub(char6,i+1,i+1) chr6[i]=c asc6[c]=i
end
char6=_n


function compresmap(h,v,x,y)
local r,b6,c6,n,c,lc="",0,0,0
  function to6(a)
    for i=1,#a do
      for j=0,7 do
        if (band(a[i],2^j)>0) c6+=2^b6
        b6+=1
        if (b6==6) r=r..chr6[c6] c6=0 b6=0
      end
    end
  end
  to6({x,y}) x-=1 y-=1
  for i=0,y do
    for j=0,x do
      c=mget(h+j,v+i)
      if (c==lc) n+=1
      if c!=lc or (j==x and i==y) then
        if n<2 then
          for k=0,n do
            to6({lc})
          end
        else
          to6({255,n,lc})
        end
        lc=c n=0
      end
    end
  end
  to6({c,0})
  return r
end

-- take 6-bit string of t and
-- decompress it to the mapper
-- as 8-bit data.
function decompresmap(h,v,t)
local r,b6,c6,cp,n=t,0,0,1,0
  function to8()
  local s=0
    for i=0,7 do
      if (b6==0) c6=asc6[sub(r,cp,cp)] cp+=1
      if (band(c6,2^b6)>0) s+=2^i
      b6=(b6+1)%6
    end
    return s
  end
  local x,y,xp,yp,c=to8()-1,to8()-1,h,v
  repeat
    if n>0 then
      n-=1
    else
      c=to8()
      if (c==255) n=to8() c=to8()
    end
    mset(xp,yp,c)
    --spr(c,xp*8,yp*8)
    xp+=1
    if (xp>h+x) xp=h yp+=1
    if (yp>v+y) return
  until forever
end

__gfx__
00000000000000000000000000000000000000000000000007600000007777700070770000000000000000000000000000000000000000000000000000010000
0000000000000ff00000000000000ff0600ff000000000007060ff000700ff070000ff700000ff700000000000000ff000000000000000000000000000010000
0070070000000ff000000ff000000ff0600ff000000ff02070f0ff000000ff060200ff070200ff0000000ff000000ff000000000000000000000000000010000
000770000000f00000000ff0000ff00006000f20000ff002700f000002ff00062f0f00072f0f000700000ff0000ff000000000000000000000000000000c0000
00077000000ffff0000ff00000f0ff0200fff02200ff00f2000fff00020ff0f020ffff6620fff007000ff00000f0ff0200000000000000000000000000000000
0070070000f0ff0200f0ff020600ff20000ff0000f0ff002002ff200020f0f0000ff000000ff0f0700f0ff020600ff2000000000000000000000000000000000
000000000600f0200600f0206000f02000f00f00600f0f00000ff000000f00000f00f0000f00f0660600f02060000f2000000000000000000000000000000000
00000000600f0020600f0020000f000000f0000060f00f0000f0f000000f00000f000f000f000f006000f020000f00f000000000000000000000000000000000
06666650100000000000000000000a98000100000000098200000000000000000000000000000000000000000000000000000000000000000000000000000000
66665555100010000000000000000898010000000000099800000000000000000000000000000000000000000000000000000000000000000000000000000000
6565655510001000000000000000098901000100000009a900000000000000000000000000000000000000000000000000000000000000000000000000000000
565655500000101000000000000009890d000100000098a900000000000000000000000000000000000000000000000000000000000000000000000000000000
65555505001000100000000000000a8900000d0000aa989800000000000000000000000000000000000000000000000000000000000000000000000000000000
55555550001000d088a98889000009990000000099a9a889000000a9000000000000000000000000000000000000000000000000000000000000000000000000
5555050500d000002988298800000989000100008898982800000a98000000000000000000000000000000000000000000000000000000000000000000000000
0550505000000000822282820000098a000100002982828900000982000000000000000000000000000000000000000000000000000000000000000000000000
06666666666666600666666000000988003030000004000003044003000000000000000000000000000000000000000000000000000000000000000000000000
66666565655555556665655500000a8830330303303b0400000b4030030003000000000000000000000000000000000000000000000000000000000000000000
6666565655555555665655550000098903033030341b0444000b4000003030300000000000000000000000000000000000000000000000000000000000000000
6665656555555555656555550000092933333333034b4403000b4000030303330000000000000000000000000000000000000000000000000000000000000000
66565555555555556655555500000888133133133103b03000444000303133130000000000000000000000000000000000000000000000000000000000000000
65655555555555556555555500000a89313313034004b01300b44000030313030000000000000000000000000000000000000000000000000000000000000000
65555555555555506555555500000a88031011300444b00000b44400031031300000000000000000000000000000000000000000000000000000000000000000
655555555555555555555555000009983103000030bb04000b44b400310313130000000000000000000000000000000000000000000000000000000000000000
65555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555505555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555055555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555550505555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555505055555550500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555505050505555505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555050505005555050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05555050505050000550500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1000130000000000000000000000131010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000230000000000000000001612152021101010102220211010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000130000000000000000001310223031101020213230311010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2200230000000000000016121510321010101030311010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3200130000000016121215202122101020212210101010202110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000230000000023202122303132101030313210222021303110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000130000000013303132101010221010101010323031101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1000230000000023000000000000321010000000000000102021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2200130000000013000000000000000000000000000000003031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3200230000000023000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212152200000013000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2021103200000023000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3031000000000013000000000000001020212200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000023000000000000202130313210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2110221010202113221020211022303120212021100000222021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3122322222303123322230312232102230313031100000323031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
